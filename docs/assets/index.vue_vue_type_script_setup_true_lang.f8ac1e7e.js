import{_ as w,s as E,b as S}from"./index.vite.6d3abbee.js";import"./mavon-Editor.fcac058e.js";/* empty css                     */import{S as te}from"./index.b279f882.js";import{G as R,z as y,d as F,ag as B,o as d,c as g,U as C,a as n,P as T,aj as Z,O as D,bf as z,be as H,_ as k,Z as q,u as o,T as N,H as ne,a0 as J,V as j,M as x,R as O,E as A,F as P,a7 as G,S as oe,h as ae,i as se,K as le}from"./@vue.fabb9c8d.js";import{u as Q}from"./vue-router.f056de20.js";import{a as f}from"./element-plus.25c24083.js";const X=a=>(z("data-v-4ce3a93c"),a=a(),H(),a),ce={class:"commentForm-box"},ie={class:"comment"},re={style:{"text-align":"right"}},me=X(()=>n("span",null,"Add Comment",-1)),ue=X(()=>n("hr",null,null,-1)),de=R({__name:"index",props:{avatar:{default:"src/assets/commentDefaultAvater.png"}},emits:["callObjectType","callListIndex"],setup(a,{emit:r}){const s=y("commentType"),p=y("commentReview"),t=y("userinfo"),e=y("saveComment"),c=F(""),l=Q().path.split("/")[2],v=async()=>{if((t==null?void 0:t.value)==null){f({title:"Warning",message:"\u8BF7\u767B\u9646\u540E\u8BC4\u8BBA",type:"warning"});return}if(c.value.trim()===""&&c.value.length===0){f({title:"Warning",message:"\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9",type:"warning"});return}const h={commentContent:c.value,type:s,userId:t.value.id,topicId:l};r("callListIndex",void 0),await e(h).then(()=>{p?f.warning("\u8BC4\u8BBA\u6210\u529F,\u6B63\u5728\u5BA1\u6838\u4E2D"):f.success("\u56DE\u590D\u6210\u529F")}),c.value="",I()},I=()=>{r("callObjectType","comment")};return(h,m)=>{const _=B("el-avatar"),u=B("el-button");return d(),g("div",ce,[C(_,{size:50,src:h.avatar},null,8,["src"]),n("div",ie,[T(n("textarea",{"onUpdate:modelValue":m[0]||(m[0]=$=>c.value=$),cols:"30",placeholder:"Add comment...",rows:"5"},null,512),[[Z,c.value]]),n("div",re,[C(u,{id:"submit-button",onClick:v},{default:D(()=>[me]),_:1})]),ue])])}}}),pe=w(de,[["__scopeId","data-v-4ce3a93c"]]),ve={class:"comment-item-box"},_e={class:"content-box"},Ce={class:"content"},ye=["innerHTML"],fe=R({__name:"index",props:{commentData:{},index:{}},setup(a){const r=a,{commentData:s,index:p}=k(r),t=q({replyContent:"add reply...",time:s.value.createTime,show:!1}),e=()=>{t.replyContent="add reply...",t.show=!1};return(c,i)=>{const l=B("el-avatar");return d(),g("div",null,[n("div",ve,[C(l,{size:50,src:o(s).avatar},null,8,["src"]),n("div",_e,[n("div",Ce,[n("p",{class:"commentContent",innerHTML:o(s).commentContent.replaceAll(`
`,"<br>")},null,8,ye),n("div",null,[n("span",null,N(o(s).nickname)+" | "+N(t.time),1),n("div",null,[n("span",{onClick:i[0]||(i[0]=v=>t.show=!0)},"Reply")])])]),C(J,{name:"fade"},{default:D(()=>[ne(c.$slots,"childComment",{commentReplyData:o(s)},void 0,!0)]),_:3}),o(s).replys?T((d(),x(o(K),{key:0,index:o(p),initialContent:t.replyContent,parentId:o(s).id,replyUserId:o(s).userId,onCancelReply:e},null,8,["index","initialContent","parentId","replyUserId"])),[[j,t.show]]):O("",!0)])]),o(s).replys?O("",!0):T((d(),x(o(K),{key:0,index:o(p),initialContent:t.replyContent,parentId:o(s).id,replyUserId:o(s).userId,onCancelReply:e},null,8,["index","initialContent","parentId","replyUserId"])),[[j,t.show]])])}}}),W=w(fe,[["__scopeId","data-v-d03ea143"]]),he={},b=a=>(z("data-v-1e897104"),a=a(),H(),a),xe={class:"loading"},De=b(()=>n("div",null,null,-1)),be=b(()=>n("div",null,null,-1)),Ie=b(()=>n("div",null,null,-1)),ge=b(()=>n("div",null,null,-1)),Be=b(()=>n("div",null,null,-1)),we=b(()=>n("div",null,null,-1)),Re=b(()=>n("div",null,null,-1)),$e=b(()=>n("div",null,null,-1)),Ae=[De,be,Ie,ge,Be,we,Re,$e];function Te(a,r){return d(),g("div",xe,Ae)}const Le=w(he,[["render",Te],["__scopeId","data-v-1e897104"]]),Fe={class:"commentList-box"},ke=R({__name:"index",props:{commentData:{},haveMore:{type:Boolean}},emits:["callObjectType","callListIndex"],setup(a,{emit:r}){A("emitCall",(t,e)=>{r("callListIndex",e),r("callObjectType",t)});const s=async()=>{r("callObjectType","loadMore")},p=t=>t.sort((e,c)=>Date.parse(String(e.createTime))-Date.parse(String(c.createTime)));return(t,e)=>{const c=B("el-button");return d(),g("div",Fe,[C(J,{name:"fade"},{default:D(()=>[(d(!0),g(P,null,G(t.commentData,(i,l)=>(d(),x(o(W),{key:i.id,commentData:i,index:l},{childComment:D(v=>[(d(!0),g(P,null,G(p(v.commentReplyData.replys),I=>(d(),x(o(W),{commentData:I,index:l},null,8,["commentData","index"]))),256))]),_:2},1032,["commentData","index"]))),128))]),_:1}),t.haveMore?(d(),x(c,{key:0,class:"button-three",onClick:s},{default:D(()=>[oe(" Load More ")]),_:1})):T((d(),x(o(Le),{key:1,style:{margin:"0 auto"}},null,512)),[[j,t.haveMore!=null]])])}}}),Me=w(ke,[["__scopeId","data-v-558fbf30"]]),Y=a=>(z("data-v-00f2a042"),a=a(),H(),a),Ee={class:"comment-reply-form"},Se={class:"comment-content-box"},je=["placeholder"],Oe=Y(()=>n("span",null,"Cancel",-1)),ze=Y(()=>n("span",null,"Reply",-1)),He=R({__name:"index",props:{replyUserId:{},initialContent:{},parentId:{},index:{}},emits:["cancelReply"],setup(a,{emit:r}){const s=a,{initialContent:p,replyUserId:t,parentId:e,index:c}=k(s),i=F(""),v=Q().path.split("/")[2],I=y("emitCall"),h=y("saveComment"),m=y("commentType"),_=y("commentReview"),u=y("userinfo"),$=async()=>{if(u===void 0){f.warning("\u8BF7\u767B\u9646\u540E\u8BC4\u8BBA~");return}if(i.value.trim()==""){f.warning("\u56DE\u590D\u4E0D\u80FD\u4E3A\u7A7A~");return}const M={type:m,replyUserId:t==null?void 0:t.value,parentId:e==null?void 0:e.value,commentContent:i.value,userId:u.id};M.topicId=v,r("cancelReply"),await I("callListIndex",c.value),await h(M),_?f.success("\u8BC4\u8BBA\u6210\u529F,\u6B63\u5728\u5BA1\u6838\u4E2D~"):f.success("\u56DE\u590D\u6210\u529F"),i.value=""};return(M,L)=>{const ee=B("el-avatar"),U=B("el-button");return d(),g("div",Ee,[C(ee,{size:50,src:o(u)?o(u).avatar:"https://c-ssl.duitang.com/uploads/blog/202206/26/20220626195022_d538d.jpeg"},null,8,["src"]),n("div",Se,[T(n("textarea",{"onUpdate:modelValue":L[0]||(L[0]=V=>i.value=V),placeholder:o(p),cols:"30",rows:"5"},null,8,je),[[Z,i.value]]),n("div",null,[C(U,{id:"submit-button",size:"small",type:"primary",onClick:L[1]||(L[1]=V=>{i.value="",r("cancelReply")})},{default:D(()=>[Oe]),_:1}),C(U,{id:"submit-button",size:"small",type:"success",onClick:$},{default:D(()=>[ze]),_:1})])])])}}}),K=w(He,[["__scopeId","data-v-00f2a042"]]),Ue=R({__name:"index",props:{commentData:{},isHaveMore:{type:Boolean},type:{},isCommentReview:{},userinfo:{},commentsCall:{type:Function},indexCall:{type:Function},formAvatar:{},save:{type:Function}},setup(a,{expose:r}){const s=a,{type:p,isCommentReview:t,userinfo:e,save:c}=k(s);A("commentType",p.value),A("commentReview",t.value),A("userinfo",e),A("saveComment",async l=>c.value(l));const i=F();return r({sidebarCommentRef:i}),(l,v)=>(d(),x(o(te),{ref_key:"sidebarCommentRef",ref:i,h:"auto",icon:"moon",title:"\u8BC4\u8BBA\u533A","ul-li-class":"sidebarClass"},{defulet:D(()=>[C(o(pe),{onCallObjectType:l.commentsCall,onCallListIndex:l.indexCall,avatar:l.formAvatar},null,8,["onCallObjectType","onCallListIndex","avatar"]),C(o(Me),{commentData:l.commentData,"have-more":l.isHaveMore,onCallObjectType:l.commentsCall,onCallListIndex:l.indexCall},null,8,["commentData","have-more","onCallObjectType","onCallListIndex"])]),_:1},512))}}),Ve=w(Ue,[["__scopeId","data-v-fb177594"]]),Je=R({__name:"index",props:{type:{},id:{}},setup(a){var h;const r=a,{type:s,id:p}=k(r),t=F(!1);ae(()=>{l()});const e=q({index:0,commentData:[],isHaveMore:void 0,current:1,size:7,isReload:!1,type:s,isCommentReview:E.getters.useState.websiteConfig.commentReview||0,userinfo:se(()=>E.getters.userinfo||void 0),formAvatar:((h=E.getters.useState.userConfig)==null?void 0:h.avatar)||void 0}),c=m=>{e.index=m},i=m=>{switch(m){case"comment":e.current=1,e.isReload=!0,l();break;case"replies":v(e.index);break;case"loadMore":e.isHaveMore=!1,l();break}},l=()=>{const m={type:e.type,current:e.current,size:e.size,topicId:p==null?void 0:p.value};S.commentApi.getCommentListByType(m).then(_=>{const{data:u}=_.data;e.isReload?(e.commentData=u.commentList,e.isReload=!1):e.commentData.push(...u.commentList),u.count===e.commentData.length?e.isHaveMore=void 0:e.isHaveMore=u.count>e.commentData.length,e.current++}),t.value=!0},v=m=>{let _=e.commentData[m].id;S.commentApi.getRepliesByCommentId({id:_}).then(u=>{const{data:$}=u.data;e.commentData[m].replys=$.replys})},I=async m=>new Promise(_=>{S.commentApi.saveComments(m).then(()=>{e.index!=-1&&e.commentData[e.index]&&v(e.index),_("")},u=>{f.error("\u56DE\u590D\u6D88\u606F\u51FA\u73B0\u5F02\u5E38"+u.message)})});return(m,_)=>t.value?(d(),x(o(Ve),le({key:0,ref:"commentsRef"},e,{commentsCall:i,"index-call":c,save:I,style:{"margin-top":"1rem"}}),null,16)):O("",!0)}});export{Je as _};
