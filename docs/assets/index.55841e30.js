import"./vue.3562d5dc.js";import{t as se}from"./timeZH.b7c8b73a.js";import{d as G,e as I,i as J,Z as F,ah as z,o as K,c as Q,a as S,U as R,O as E,B as H,u as N,S as O}from"./@vue.34c5d192.js";import{_ as ee}from"./index.vite.5e077c20.js";import"./call-bind.10384396.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./vue-router.18efbaf4.js";import"./axios.f2a602b3.js";import"./element-plus.725704b3.js";import"./lodash-es.edba6135.js";import"./@vueuse.2505887c.js";import"./@element-plus.1592eb84.js";import"./@popperjs.36402333.js";import"./@ctrl.b082b0c1.js";import"./dayjs.09808879.js";import"./async-validator.267d9719.js";import"./memoize-one.4ee5c96d.js";import"./normalize-wheel-es.8aeb3683.js";import"./@floating-ui.7ffd8050.js";import"./qs.b7100b69.js";import"./side-channel.e4d943d6.js";import"./object-inspect.c9d9bc85.js";import"./js-cookie.711e9524.js";import"./vuex.0cf65d54.js";import"./vuex-persistedstate.fa252374.js";import"./nprogress.0db61dbe.js";import"./mavon-Editor.8efb2a5b.js";/* empty css                     */import"./vue-i18n.837ed9a9.js";import"./@intlify.3326f550.js";import"./mockjs.feb59d68.js";const re="/vue3_ts_project/assets/index_bunner.334a2b10.jpg",ne=["src"],oe=G({__name:"index",setup(te){const U=I(),_=I();J(()=>{M()});let r=I(0);const s=F({w:0,h:0,ctx:{},layers:[],L:-1}),m=F({scale:1,img:{},movePos:{x:0,y:0},offsetX:0,offsetY:0,startP:{x:0,y:0}}),M=()=>{m.img=new Image,m.img.src=re,m.img.width=500,m.img.height=500;const{width:c,height:i}=_.value.getBoundingClientRect();s.w=c,s.h=i,_.value.width=s.w,_.value.height=s.h,s.ctx=_.value.getContext("2d"),P()},P=()=>{s.ctx.drawImage(m.img,0,0,m.img.width,m.img.height,m.offsetX,m.offsetY,m.img.width*m.scale,m.img.height*m.scale)},e=F({scale:1,layers:[],currentR:-1,isclick:0,startP:{x:0,y:0},movePos:{x:0,y:0},isScale:0,direction:-1,line:{},isArrow:0}),t=F({scale:1,layers:[],currentR:-1,isclick:0,startP:{x:0,y:0},movePos:{x:0,y:0},isScale:0,w:0,h:0,rect:{},restSize:0}),p=F({startP:{x:0,y:0},movePos:{x:0,y:0},w:0,h:0,clip:{}}),X=c=>{const i=(a,o,n,l,d="#212121",g=1,v=1,T)=>{const C=Math.atan2(l-o,n-a);s.ctx.beginPath(),s.ctx.save();let j=n-a,V=l-o,D={x:a+j/2,y:o+V/2};if(s.ctx.translate(D.x*(1-v),D.y*(1-(v-.1))),s.ctx.scale(v,v-.1),s.ctx.strokeStyle=d,s.ctx.lineWidth=g,s.ctx.moveTo(a,o),s.ctx.lineTo(n,l),s.ctx.restore(),s.ctx.stroke(),T!=0){s.ctx.beginPath(),s.ctx.save();let A=n-a,k=l-o,b={x:a+A/2,y:o+k/2};s.ctx.translate(b.x*(1-v),b.y*(1-(v-.1))),s.ctx.scale(v,v-.1),s.ctx.moveTo(n,l),s.ctx.lineTo(n-10*Math.cos(C+Math.PI/6),l-10*Math.sin(C+Math.PI/6)),s.ctx.lineTo(n-10*Math.cos(C-Math.PI/6),l-10*Math.sin(C-Math.PI/6)),s.ctx.closePath(),s.ctx.restore(),s.ctx.fill()}};c?i(c.x,c.y,c.endx,c.endy,void 0,void 0,1,c.isArrow):e.layers.forEach(a=>{i(a.x,a.y,a.endx,a.endy,void 0,void 0,a.scale,a.isArrow)})},L=c=>{const i=(a,o,n,l,d,g)=>{s.ctx.beginPath(),s.ctx.save(),s.ctx.translate(a+l/2,o+n/2),s.ctx.scale(d,d),s.ctx.restore(),s.ctx.strokeRect(a,o,l*d,n*d),s.ctx.beginPath(),s.ctx.strokeRect(a+l-10,o+n-10,10,10)};c?i(c.x,c.y,c.h,c.w,c.scale):t.layers.forEach((a,o)=>{i(a.x,a.y,a.h,a.w,a.scale)})},Y=()=>{s.ctx.beginPath(),s.ctx.strokeRect(p.startP.x,p.startP.y,p.w+2,p.h+2)},B=()=>{s.ctx.clearRect(0,0,s.w,s.h),P(),X(e.line),L(t.rect),L(),X(),r.value==4&&Y()},Z=c=>{const{clientX:i,clientY:a}=c;if(y(i,a)&&r.value===1){s.ctx.save();const o=c.deltaY<0?1.1:.9;m.scale*=o,m.scale=Math.min(Math.max(m.scale,.1),5),s.ctx.translate(0,0),s.ctx.scale(m.scale,m.scale),s.ctx.restore()}else if(e.isclick!=1&&r.value===2){e.isScale=1;let o=u(i,a);e.currentR=0;for(let l=0;l<e.layers.length;l++){const d=e.layers[l];if(f(o.x,o.y,{x1:d.x,x2:d.endx,y1:d.y,y2:d.endy})<5){e.currentR=l;break}else e.currentR=-1}if(e.currentR==-1)return!1;const n=c.deltaY<0?1.1:.9;e.layers[e.currentR].scale*=n,e.layers[e.currentR].scale=Math.min(Math.max(e.layers[e.currentR].scale,.1),5)}else if(t.isclick!=1&&r.value===3){t.isScale=1;let o=u(i,a);t.currentR=0;for(let l=0;l<t.layers.length;l++){const d=t.layers[l];if(w(o,d)){t.currentR=l;break}else t.currentR=-1}if(t.currentR==-1)return!1;const n=c.deltaY<0?1.1:.9;t.layers[t.currentR].scale*=n,t.layers[t.currentR].scale=Math.min(Math.max(t.layers[t.currentR].scale,.1),5)}B()},$=c=>{if(s.L!=1)return!1;const{pageX:i,pageY:a}=c;if(r.value==1){if(!y(i,a))return x(),!1;m.movePos=u(i,a);const o=m.movePos.x-m.startP.x,n=m.movePos.y-m.startP.y;m.offsetX+=o,m.offsetY+=n,m.startP={...m.movePos}}else if(r.value==2){e.movePos=u(i,a),s.ctx.clearRect(0,0,s.w,s.h);let o=e.layers[e.currentR]==null?e.scale:e.layers[e.currentR].scale;if(e.isclick!=0){const n=e.movePos.x-e.startP.x,l=e.movePos.y-e.startP.y;e.direction==0?(e.layers[e.currentR].x+=n,e.layers[e.currentR].y+=l):e.direction==1?(e.layers[e.currentR].endx+=n,e.layers[e.currentR].endy+=l):(e.layers[e.currentR].x+=n,e.layers[e.currentR].y+=l,e.layers[e.currentR].endx+=n,e.layers[e.currentR].endy+=l,e.layers[e.currentR].scale=e.scale),e.startP={...e.movePos}}else{let n={x:e.startP.x,y:e.startP.y,endx:e.movePos.x,endy:e.movePos.y,scale:o,isArrow:e.isArrow};e.line=n}}else if(r.value==3){t.movePos=u(i,a),t.w=t.movePos.x-t.startP.x,t.h=t.movePos.y-t.startP.y,(t.w<0||t.h<0)&&(t.w=t.w>0?t.w:20,t.h=t.h>0?t.h:20),s.ctx.clearRect(0,0,s.w,s.h);let o=t.layers[t.currentR]==null?t.scale:t.layers[t.currentR].scale;if(t.isclick!=0){if(t.restSize!=0){const n=t.movePos.x-t.startP.x,l=t.movePos.y-t.startP.y;let d=t.layers[t.currentR];t.movePos.x>=d.x+20&&t.movePos.y>=d.y+30&&(t.layers[t.currentR].w+=n,t.layers[t.currentR].h+=l)}else{const n=t.movePos.x-t.startP.x,l=t.movePos.y-t.startP.y;t.layers[t.currentR].x+=n,t.layers[t.currentR].y+=l}t.startP={...t.movePos}}else{let n={x:t.startP.x,y:t.startP.y,w:t.w,h:t.h,scale:o};t.rect=n}}else if(r.value==4){p.movePos=u(i,a);let o=p.movePos.x-p.startP.x,n=p.movePos.y-p.startP.y;p.w=o,p.h=n;let l=s.ctx.getImageData(p.startP.x,p.startP.y,o,n),d=document.createElement("canvas");d.width=o,d.height=n,d.getContext("2d").putImageData(l,0,0),p.clip=d.toDataURL("image/png")}B()},W=c=>{const{pageX:i,pageY:a}=c;if(s.L=1,r.value==1)m.startP=u(i,a);else if(r.value==2){e.startP=u(i,a),e.isclick=0,e.currentR=-1;for(let o=0;o<e.layers.length;o++){const n=e.layers[o];if(f(e.startP.x,e.startP.y,{x1:n.x,x2:n.endx,y1:n.y,y2:n.endy})<5){e.currentR=o,e.isclick=1;break}else e.currentR=-1}e.layers.length!=0&&e.currentR!=-1&&(e.startP.x>=e.layers[e.currentR].x&&e.startP.y+5>=e.layers[e.currentR].y&&e.startP.x<=e.layers[e.currentR].x+20&&e.startP.y<=e.layers[e.currentR].y+5?e.direction=0:e.startP.x<=e.layers[e.currentR].endx&&e.startP.y+5>=e.layers[e.currentR].endy&&e.startP.x>=e.layers[e.currentR].endx-20&&e.startP.y<=e.layers[e.currentR].endy+5?e.direction=1:e.direction=-1)}else if(r.value==3){t.startP=u(i,a),t.isclick=0,t.currentR=-1;for(let o=0;o<t.layers.length;o++){const n=t.layers[o];if(w(t.startP,n)){t.isclick=1,t.currentR=o;break}else t.currentR=-1}if(t.currentR!=-1){let o=t.layers[t.currentR],n=o.x+o.w,l=o.y+o.h;t.startP.x>=n-10&&t.startP.y>=l-10&&t.startP.x<=n&&t.startP.y<=l?t.restSize=1:t.restSize=0}}else r.value==4&&(p.startP=u(i,a))},x=()=>{s.L=0,e.isclick=0,t.isclick=0,r.value===2&&e.isclick!=1&&(e.line!=null&&e.layers.push(e.line),e.line={}),r.value===3&&t.isclick!=1&&(t.rect!=null&&t.layers.push(t.rect),t.rect=null)},u=(c,i)=>{const{left:a,top:o,width:n,height:l}=s.ctx.canvas.getBoundingClientRect();return{x:c-a-(n-s.ctx.canvas.width)/2,y:i-o-(l-s.ctx.canvas.height)/2}},y=(c,i)=>{const{left:a,top:o,width:n,height:l}=s.ctx.canvas.getBoundingClientRect();let d=a+m.offsetX,g=o+m.offsetY,v=d+n*m.scale,T=g+l*m.scale;return c>d&&i>g&&c<v&&i<T},f=(c,i,a)=>{const{x1:o,y1:n,x2:l,y2:d}=a,g=c-o,v=i-n,T=l-o,C=d-n,j=g*T+v*C,V=T*T+C*C;let D=-1;V!==0&&(D=j/V);let A,k;D<0?(A=o,k=n):D>1?(A=l,k=d):(A=o+D*T,k=n+D*C);const b=c-A,q=i-k;return Math.sqrt(b*b+q*q)},w=(c,i,a=1)=>c.x>=i.x&&c.x<=i.x+i.w*a&&c.y>=i.y&&c.y<=i.y+i.h*a,h=()=>{let c=document.createElement("a");c.href=p.clip,c.download="cropped_image.png",c.click()};return(c,i)=>{const a=z("el-button"),o=z("el-tooltip");return K(),Q("div",{class:"imageContainer",ref_key:"imageContainer",ref:U},[S("canvas",{ref_key:"canvas",ref:_,width:"500",height:"500",class:"canvas",onWheel:Z,onMousemove:$,onMousedown:W,onMouseup:x},null,544),S("div",null,[S("span",null,[R(o,{placement:"top",trigger:"hover",content:"\u56FE\u7247\u533A\u57DF\u5185\u62D6\u52A8\uFF0C\u6ED1\u8F6E\u653E\u5927\u7F29\u5C0F"},{default:E(()=>[R(a,{type:"primary",onClick:i[0]||(i[0]=n=>{H(r)?r.value=1:r=1,e.isArrow=0}),color:N(r)===1?"#212121":"#fff"},{default:E(()=>[O("\u64CD\u4F5C\u80CC\u666F\u56FE")]),_:1},8,["color"])]),_:1}),R(o,{placement:"top",trigger:"hover",content:"\u62D6\u52A8\u4E24\u7AEF\u5373\u53EF\u6539\u53D8\u5C3A\u5BF8,\u5176\u4ED6\u5730\u65B9\u62D6\u52A8\u4F4D\u7F6E\uFF0C\u6ED1\u8F6E\u63A7\u5236\u653E\u5927/\u7F29\u653E\u6BD4\u4F8B,\u62D6\u52A8\u65F6\u8FD8\u539F\u6BD4\u4F8B"},{default:E(()=>[R(a,{type:"primary",onClick:i[1]||(i[1]=n=>{H(r)?r.value=2:r=2,e.isArrow=0}),color:N(r)===2&&e.isArrow==0?"#212121":"#fff"},{default:E(()=>[O("\u7ED8\u5236\u7EBF\u6BB5")]),_:1},8,["color"])]),_:1}),R(o,{placement:"top",trigger:"hover",content:"\u9650\u5236\u4EC5\u5411\u53F3\u7ED8\u5236,\u5F02\u5E38\u7ED8\u5236\u4FEE\u590D,\u62D6\u52A8\u53F3\u4E0B\u89D2(10x10\u8303\u56F4\u5185)\u6539\u53D8\u5C3A\u5BF8,\u533A\u57DF\u5185\u62D6\u52A8(\u6700\u4E0A\u5C42\u6743\u91CD\u5927)\uFF0C\u6ED1\u8F6E\u63A7\u5236\u6BD4\u4F8B"},{default:E(()=>[R(a,{type:"primary",onClick:i[2]||(i[2]=n=>{H(r)?r.value=3:r=3,e.isArrow=0}),color:N(r)===3?"#212121":"#fff"},{default:E(()=>[O("\u7ED8\u5236\u77E9\u5F62")]),_:1},8,["color"])]),_:1}),R(o,{placement:"top",trigger:"hover",content:"\u62D6\u52A8\u4E24\u7AEF\u5373\u53EF\u6539\u53D8\u5C3A\u5BF8,\u5176\u4ED6\u5730\u65B9\u62D6\u52A8\u4F4D\u7F6E\uFF0C\u6ED1\u8F6E\u63A7\u5236\u653E\u5927/\u7F29\u653E\u6BD4\u4F8B,\u62D6\u52A8\u65F6\u8FD8\u539F\u6BD4\u4F8B"},{default:E(()=>[R(a,{type:"primary",onClick:i[3]||(i[3]=n=>{H(r)?r.value=2:r=2,e.isArrow=1}),color:e.isArrow==1?"#212121":"#fff"},{default:E(()=>[O("\u7ED8\u5236\u7BAD\u5934")]),_:1},8,["color"])]),_:1}),R(a,{type:"primary",onClick:i[4]||(i[4]=n=>{H(r)?r.value=4:r=4,e.isArrow=0}),color:N(r)===4?"#212121":"#fff"},{default:E(()=>[O("\u622A\u56FE")]),_:1},8,["color"]),R(a,{type:"primary",onClick:h},{default:E(()=>[O("\u4FDD\u5B58\u672C\u5730")]),_:1})]),S("img",{src:p.clip,alt:"\u622A\u56FE"},null,8,ne)])],512)}}});const ae=ee(oe,[["__scopeId","data-v-6b7ae98f"],["__file","E:/vue3_ts_project/src/views/Client/components/image/index.vue"]]),ie={class:"container"},le=G({__name:"index",setup(te){const U=I(),_=I();J(()=>{m()});const r=F({width:0,height:0,ctx:{},ONE_HOUR_STAMP:60*60*1e3,xTime:0}),s=F({ZOOM:24,currentTime:0,startTimestamp:new Date(new Date().toISOString().slice(0,19).replace("T"," ")).getTime()-12*r.ONE_HOUR_STAMP,mousedownX:0,mousedown:!1,mousedownCacheStartTimestamp:0}),m=async()=>{const{width:x,height:u}=U.value.getBoundingClientRect();r.width=x,r.height=u,_.value.width=r.width,_.value.height=r.height,r.ctx=_.value.getContext("2d"),r.xTime=M.getTime(),t()};let M=new Date(s.startTimestamp);const P=F({h:M.getHours()+12,m:M.getMinutes(),s:M.getSeconds()}),e=()=>{let x=new Date(s.startTimestamp);x.setHours(P.h-12),x.setMinutes(P.m),x.setSeconds(P.s),s.startTimestamp=x.getTime(),B()},t=()=>{X(),L(),Y()},p=(x,u,y,f,w=1,h)=>{r.ctx.beginPath(),r.ctx.strokeStyle=h,r.ctx.lineWidth=w,r.ctx.moveTo(x,u),r.ctx.lineTo(y,f),r.ctx.stroke()},X=()=>{const u=r.width/2;let y=r.height*.03,f=y+50;p(u,y,u,f,2,"#A00000"),r.ctx.fillText(se(r.xTime),u-30,10)},L=()=>{let x=r.ONE_HOUR_STAMP,u=x-s.startTimestamp%x,y=r.width/s.ZOOM,f=u/x*y,w=0;for(;w<s.ZOOM;){let h=f+w*y,c=s.startTimestamp+u+w*x,i=r.height*.25,a=i+5;r.ctx.fillStyle="#fff";let o=n=>{let l=new Date(n);if(l.getHours()!=0)return l.getHours()+"";{let d=l.getMonth()+1,g=l.getDate();return d+"\u6708"+g+"\u65E5"}};if(r.ctx.fillText(o(c),o(c).includes("\u6708")?h-13:h-5,i-10),p(h,i,h,a,1,"#fff"),w++,w==12){const n=r.width/(s.ZOOM*r.ONE_HOUR_STAMP);r.xTime=s.startTimestamp+h/n}}},Y=()=>{const x=r.width/(s.ZOOM*r.ONE_HOUR_STAMP);let u=new Date(s.startTimestamp).getHours(),y=new Date(s.startTimestamp).getMinutes(),f=(u+12)*60+y,w=19.5*60,h=20.16*60;const c=(i,a,o,n,l="#00d0ff")=>{let d=new Date(s.startTimestamp+12*r.ONE_HOUR_STAMP);d.setHours(i,a,0,0);let g=new Date(s.startTimestamp+12*r.ONE_HOUR_STAMP);g.setHours(o,n,0,0);let v=(d.getTime()-s.startTimestamp)*x,T;v<0?(v=0,T=(g.getTime()-s.startTimestamp)*x):T=(g.getTime()-d.getTime())*x,r.ctx.fillStyle=l,r.ctx.fillRect(v,r.height*.35,T,r.height*.1)};f>=w&&f<=h?c(19,30,20,10,"#00d0ff"):f>=h&&f<=h+.17*60&&c(20,10,20,20,"#4d4d4d")},B=()=>{r.ctx.clearRect(0,0,r.width,r.height),t()},Z=x=>{let{left:u}=_.value.getBoundingClientRect(),y=x.clientX-u;const f=r.width/(s.ZOOM*r.ONE_HOUR_STAMP);if(s.mousedown){let w=y-s.mousedownX;s.startTimestamp=s.mousedownCacheStartTimestamp-Math.round(w/f);let h=new Date(s.startTimestamp);P.h=h.getHours()+12>=24?h.getHours()-12:h.getHours()+12,P.m=h.getMinutes(),P.s=h.getSeconds(),B()}},$=()=>{s.mousedown=!1},W=x=>{let{left:u}=_.value.getBoundingClientRect();s.mousedownX=x.clientX-u,s.mousedown=!0,s.mousedownCacheStartTimestamp=s.startTimestamp};return(x,u)=>{const y=z("el-input-number");return K(),Q("div",{class:"timeLineContainer",ref_key:"timeLineContainer",ref:U},[S("canvas",{ref_key:"canvas",ref:_,onMousemove:Z,onMouseout:$,onMousedown:W,onMouseup:u[0]||(u[0]=f=>s.mousedown=!1)},null,544),S("span",ie,[R(y,{modelValue:P.h,"onUpdate:modelValue":u[1]||(u[1]=f=>P.h=f),class:"mx-4",min:0,max:23,"controls-position":"right",onChange:e},null,8,["modelValue"]),R(y,{modelValue:P.m,"onUpdate:modelValue":u[2]||(u[2]=f=>P.m=f),class:"mx-4",min:1,max:59,"controls-position":"right",onChange:e},null,8,["modelValue"]),R(y,{modelValue:P.s,"onUpdate:modelValue":u[3]||(u[3]=f=>P.s=f),class:"mx-4",min:1,max:59,"controls-position":"right",onChange:e},null,8,["modelValue"])]),R(ae)],512)}}});const Ze=ee(le,[["__scopeId","data-v-823ca893"],["__file","E:/vue3_ts_project/src/views/Client/components/TimeZhou/index.vue"]]);export{Ze as default};
